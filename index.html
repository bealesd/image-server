<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beales Images</title>
    <link rel="stylesheet" href="./assets/styles/style.css">
</head>

<body>
    <button id='photos'>Photos</button>
    <button id='directory'>Directory</button>
    <button id='albums'>Albums</button>

    <div id="photoControls" class="hidden">
        <h1 id="pageNumber"></h1>
        <button id="back">Back</button>
        <button id="next">Next</button>
    </div>

    <div id="container"></div>

    <script type="module">
        import {
            Secrets
        } from './assets/secrets.js';
        const ipAddress = new Secrets().ipAddress;
        const pageIncrement = 3;
        let start = 0;

        const backButton = document.querySelector('#back');
        const nextButton = document.querySelector('#next');
        const directoryButton = document.querySelector('#directory');
        const photosButton = document.querySelector('#photos');
        const photoControls = document.querySelector('#photoControls')

        function changePage(option) {
            if (option.forward)
                start += pageIncrement;
            else
                start -= pageIncrement;
        }

        function printPage () {
            document.querySelector('#pageNumber').innerHTML = `Page: ${Math.floor(start / pageIncrement)}`;
        }

        photosButton.addEventListener('click', async() => {
            printPage();
            photoControls.classList.remove('hidden');
            let page = await fetch(`http://${ipAddress}:8080/images?start=${start}&number=3`);
            let content = await page.text();
            document.querySelector('#container').innerHTML = content;
        });

        backButton.addEventListener('click', async() => {
            changePage({
                forward: false
            });
            printPage();
            let page = await fetch(`http://${ipAddress}:8080/images?start=${start}&number=3`);
            let content = await page.text();
            document.querySelector('#container').innerHTML = content;
        });

        nextButton.addEventListener('click', async() => {
            changePage({
                forward: true
            });
            printPage();
            let page = await fetch(`http://${ipAddress}:8080/images?start=${start}&number=${3}`);
            let content = await page.text();
            document.querySelector('#container').innerHTML = content;
        });



        directoryButton.addEventListener('click', async() => {
            photoControls.classList.add('hidden');

            let request = await fetch(`http://${ipAddress}:8080/listDirectory`);
            let directory = await request.json();
            document.querySelector('#container').innerHTML = '';
            directory.forEach((dir) => {
                const href = `http://${ipAddress}:8080/listDirectory?dir=${dir}`;
                document.querySelector('#container').innerHTML += `<div><a href="${href}">${dir}</a></div>`
            })
        });
    </script>
</body>

</html>
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Beales Images</title>
    <link rel="stylesheet" href="./assets/styles/style.css">
</head>

<body>
    <button id='photos'>Photos</button>
    <button id='directory'>Directory</button>
    <button id='albums'>Albums</button>

    <div id="photoControls" class="hidden">
        <h1 id="pageNumber"></h1>
        <button id="back">Back</button>
        <button id="next">Next</button>
    </div>

    <div id="container"></div>

    <script type="module">
        import { Config } from '/config.js';

        let ipAddress = new Config().ipAddress;
        ipAddress = 'localhost';
        const port = new Config().port;
        const baseUrl = `http://${ipAddress}:${port}`;

        const pageIncrement = 3;
        let start = 0;

        const backButton = document.querySelector('#back');
        const nextButton = document.querySelector('#next');
        const directoryButton = document.querySelector('#directory');
        const photosButton = document.querySelector('#photos');
        const photoControls = document.querySelector('#photoControls')

        function changePage(option) {
            if (option.forward)
                start += pageIncrement;
            else
                start -= pageIncrement;
        }

        function printPage () {
            document.querySelector('#pageNumber').innerHTML = `Page: ${Math.floor(start / pageIncrement)}`;
        }

        async function getImages(){
            let req = await fetch(`${baseUrl}/images?start=${start}&number=3`);
            let images = await req.json();
            let content = '';

            Object.keys(images).forEach((img)=>{
                const image = images[img];
                let imageDiv = `<div class="responsive">
                    <div class="gallery">
                        <a target="" href="image?id=${img}">
                            <img src="image?id=${img}" alt="${image.mageName}" width="600" height="400">
                        </a>
                        <div class="desc">${image.day}/${image.month}/${image.year}</div>
                    </div>
                </div>`;
                content += imageDiv;
            })


            document.querySelector('#container').innerHTML = content;
        }

        photosButton.addEventListener('click', async() => {
            printPage();
            photoControls.classList.remove('hidden');
            await getImages();

        });

        backButton.addEventListener('click', async() => {
            changePage({
                forward: false
            });
            printPage();
            await getImages();
        });

        nextButton.addEventListener('click', async() => {
            changePage({
                forward: true
            });
            printPage();
            await getImages();
        });

        directoryButton.addEventListener('click', async() => {
            photoControls.classList.add('hidden');

            let request = await fetch(`${baseUrl}/listDirectory`);
            let directories = await request.json();
            document.querySelector('#container').innerHTML = '';

            let content = '';

            Object.keys(directories).forEach((dir)=>{
                const directory = directories[dir];
                let href = '';
                if (directory.isFile){
                    href = `${baseUrl}/image?id=${dir}`;
                }
                else {
                    href = `${baseUrl}/listDirectory?dir=${dir}`;
                }
                
                let dirDiv = `<div><a href="${href}">${dir}</a></div>`;
                content += dirDiv;
            });

            document.querySelector('#container').innerHTML = content;

        });
    </script>
</body>

</html>